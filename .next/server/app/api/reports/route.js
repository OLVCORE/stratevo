(()=>{var e={};e.id=647,e.ids=[647],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4044:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>O,workUnitAsyncStorage:()=>p});var o={};t.r(o),t.d(o,{GET:()=>u,POST:()=>d});var s=t(5612),a=t(2097),n=t(4344),i=t(2533);async function d(e){try{let r=await Object(function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}())(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r?.user?.email)return i.NextResponse.json({message:"N\xe3o autorizado"},{status:401});let{cnpj:t,website:o}=await e.json();if(!t)return i.NextResponse.json({message:"CNPJ \xe9 obrigat\xf3rio"},{status:400});await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())();let s=await Object(function(){var e=Error("Cannot find module '@/lib/models/User'");throw e.code="MODULE_NOT_FOUND",e}())({email:r.user.email});if(!s)return i.NextResponse.json({message:"Usu\xe1rio n\xe3o encontrado"},{status:404});if(-1!==s.reportsLimit&&s.reportsCount>=s.reportsLimit)return i.NextResponse.json({message:"Limite de relat\xf3rios atingido. Fa\xe7a upgrade do seu plano."},{status:403});let a=Object(function(){var e=Error("Cannot find module '@/lib/models/Report'");throw e.code="MODULE_NOT_FOUND",e}())({userId:s._id,companyName:"Empresa a ser analisada",cnpj:t,website:o,status:"processing"});return await a.save(),s.reportsCount+=1,await s.save(),c(a._id,t,o),i.NextResponse.json({message:"Relat\xf3rio iniciado",reportId:a._id,status:"processing"},{status:201})}catch(e){return console.error("Create report error:",e),i.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}async function u(e){try{let e=await Object(function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}())(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!e?.user?.email)return i.NextResponse.json({message:"N\xe3o autorizado"},{status:401});await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())();let r=await Object(function(){var e=Error("Cannot find module '@/lib/models/User'");throw e.code="MODULE_NOT_FOUND",e}())({email:e.user.email});if(!r)return i.NextResponse.json({message:"Usu\xe1rio n\xe3o encontrado"},{status:404});let t=await Object(function(){var e=Error("Cannot find module '@/lib/models/Report'");throw e.code="MODULE_NOT_FOUND",e}())({userId:r._id}).sort({createdAt:-1}).limit(20);return i.NextResponse.json({reports:t})}catch(e){return console.error("Get reports error:",e),i.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}async function c(e,r,t){try{await new Promise(e=>setTimeout(e,5e3)),await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())();let t=await Object(function(){var e=Error("Cannot find module '@/lib/models/Report'");throw e.code="MODULE_NOT_FOUND",e}())(e);t&&(t.status="completed",t.data={cadastral:{cnpj:r,status:"Processado"},financial:{status:"Processado"},digital:{status:"Processado"},commercial:{status:"Processado"},supplyChain:{status:"Processado"},news:{status:"Processado"},swot:{status:"Processado"}},await t.save())}catch(t){console.error("Process report error:",t),await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())();let r=await Object(function(){var e=Error("Cannot find module '@/lib/models/Report'");throw e.code="MODULE_NOT_FOUND",e}())(e);r&&(r.status="failed",await r.save())}}!function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/models/Report'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/models/User'");throw e.code="MODULE_NOT_FOUND",e}();let l=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/reports/route",pathname:"/api/reports",filename:"route",bundlePath:"app/api/reports/route"},resolvedPagePath:"C:\\Projects\\01 - Stratevo\\src\\app\\api\\reports\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:O,workUnitAsyncStorage:p,serverHooks:m}=l;function f(){return(0,n.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:p})}},4436:()=>{},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7588:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[344,488],()=>t(4044));module.exports=o})();