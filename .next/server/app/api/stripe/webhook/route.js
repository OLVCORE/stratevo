(()=>{var e={};e.id=287,e.ids=[287],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3705:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>O,routeModule:()=>u,serverHooks:()=>l,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>p});var o={};r.r(o),r.d(o,{POST:()=>d});var s=r(5612),n=r(2097),a=r(4344),i=r(2533);async function d(e){let t,r=await e.text(),o=e.headers.get("stripe-signature");try{t=Object(function(){var e=Error("Cannot find module '@/lib/stripe'");throw e.code="MODULE_NOT_FOUND",e}()).webhooks.constructEvent(r,o,process.env.STRIPE_WEBHOOK_SECRET)}catch(e){return i.NextResponse.json({message:"Webhook signature verification failed"},{status:400})}try{switch(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())(),t.type){case"checkout.session.completed":let e=t.data.object,r=e.metadata?.userId,o=e.metadata?.plan;if(r&&o){let e=await Object(function(){var e=Error("Cannot find module '@/lib/models/User'");throw e.code="MODULE_NOT_FOUND",e}())(r);e&&(e.plan=o,e.reportsLimit=Object(function(){var e=Error("Cannot find module '@/lib/stripe'");throw e.code="MODULE_NOT_FOUND",e}())[o].reportsLimit,await e.save())}break;case"customer.subscription.updated":case"customer.subscription.deleted":t.data.object}return i.NextResponse.json({received:!0})}catch(e){return console.error("Webhook error:",e),i.NextResponse.json({message:"Webhook handler failed"},{status:500})}}!function(){var e=Error("Cannot find module '@/lib/stripe'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/models/User'");throw e.code="MODULE_NOT_FOUND",e}();let u=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"C:\\Projects\\01 - Stratevo\\src\\app\\api\\stripe\\webhook\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:c,workUnitAsyncStorage:p,serverHooks:l}=u;function O(){return(0,a.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:p})}},4436:()=>{},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7588:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[344,488],()=>r(3705));module.exports=o})();